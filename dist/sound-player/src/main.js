define("happy/app/BaseApp",[],function(){var e=function(){var e=this,t=function(){};e.container=document.body,e.setup=t,e.update=t,e.draw=t,e.onKeyUp=t,e.onKeyDown=t,e.onMouseOver=t,e.onMouseOut=t,e.onMouseDown=t,e.onMouseUp=t,e.onMouseMove=t,e.onClick=t,e.onDoubleClick=t,e.onResize=t,e.setFPS=t,e.enterFullscreen=t,e.exitFullscreen=t,e.toggleFullscreen=t,e.isFullscreen=t};return e}),function(e){var t=t||{};t.gui=t.gui||{},t.utils=t.utils||{},t.controllers=t.controllers||{},t.dom=t.dom||{},t.color=t.color||{},t.utils.css=function(){return{load:function(e,t){t=t||document;var n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){t=t||document;var n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),t.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){var n=t.call(arguments);for(var r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(t,n,r){if(e&&t.forEach===e)t.forEach(n,r);else if(t.length===t.length+0){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i)===this.BREAK)return}else for(var i in t)if(n.call(r,t[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}(),t.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=undefined,this.__onFinishChange=undefined};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(t.utils.common),t.dom.dom=function(e){function i(t){if(t==="0"||e.isUndefined(t))return 0;var n=t.match(r);return e.isNull(n)?0:parseFloat(n[1])}var t={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},n={};e.each(t,function(t,r){e.each(t,function(e){n[e]=r})});var r=/(\d+(\.\d+)?)px/,s={makeSelectable:function(e,t){if(e===undefined||e.style===undefined)return;e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off"},makeFullscreen:function(t,n,r){e.isUndefined(n)&&(n=!0),e.isUndefined(r)&&(r=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,r,i,s){i=i||{};var o=n[r];if(!o)throw new Error("Event type "+r+" not supported.");var u=document.createEvent(o);switch(o){case"MouseEvents":var a=i.x||i.clientX||0,f=i.y||i.clientY||0;u.initMouseEvent(r,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,f,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=u.initKeyboardEvent||u.initKeyEvent;e.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:undefined,charCode:undefined}),l(r,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:u.initEvent(r,i.bubbles||!1,i.cancelable||!0)}e.defaults(u,s),t.dispatchEvent(u)},bind:function(e,t,n,r){return r=r||!1,e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on"+t,n),s},unbind:function(e,t,n,r){return r=r||!1,e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on"+t,n),s},addClass:function(e,t){if(e.className===undefined)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return s},removeClass:function(e,t){if(t){if(e.className!==undefined)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))}}else e.className=undefined;return s},hasClass:function(e,t){return(new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)")).test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t.width)},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return s}(t.utils.common),t.controllers.OptionController=function(e,t,n){var r=function(e,i,s){r.superclass.call(this,e,i);var o=this;this.__select=document.createElement("select");if(n.isArray(s)){var u={};n.each(s,function(e){u[e]=e}),s=u}n.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)}),this.domElement.appendChild(this.__select)};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){var t=r.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t},updateDisplay:function(){return this.__select.value=this.getValue(),r.superclass.prototype.updateDisplay.call(this)}}),r}(t.controllers.Controller,t.dom.dom,t.utils.common),t.controllers.NumberController=function(e,t){function r(e){return e=e.toString(),e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var n=function(e,i,s){n.superclass.call(this,e,i),s=s||{},this.__min=s.min,this.__max=s.max,this.__step=s.step,t.isUndefined(this.__step)?this.initialValue==0?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=r(this.__impliedStep)};return n.superclass=e,t.extend(n.prototype,e.prototype,{setValue:function(e){return this.__min!==undefined&&e<this.__min?e=this.__min:this.__max!==undefined&&e>this.__max&&(e=this.__max),this.__step!==undefined&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),n}(t.controllers.Controller,t.utils.common),t.controllers.NumberControllerBox=function(e,t,n){function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var r=function(e,i,s){function a(){var e=parseFloat(o.__input.value);n.isNaN(e)||o.setValue(e)}function f(){a(),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(e){t.bind(window,"mousemove",c),t.bind(window,"mouseup",h),u=e.clientY}function c(e){var t=u-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),u=e.clientY}function h(){t.unbind(window,"mousemove",c),t.unbind(window,"mouseup",h)}this.__truncationSuspended=!1,r.superclass.call(this,e,i,s);var o=this,u;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",a),t.bind(this.__input,"blur",f),t.bind(this.__input,"mousedown",l),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():i(this.getValue(),this.__precision),r.superclass.prototype.updateDisplay.call(this)}}),r}(t.controllers.NumberController,t.dom.dom,t.utils.common),t.controllers.NumberControllerSlider=function(e,t,n,r,i){function o(e,t,n,r,i){return r+(i-r)*((e-t)/(n-t))}var s=function(e,n,r,i,u){function f(e){t.bind(window,"mousemove",l),t.bind(window,"mouseup",c),l(e)}function l(e){e.preventDefault();var n=t.getOffset(a.__background),r=t.getWidth(a.__background);return a.setValue(o(e.clientX,n.left,n.left+r,a.__min,a.__max)),!1}function c(){t.unbind(window,"mousemove",l),t.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}s.superclass.call(this,e,n,{min:r,max:i,step:u});var a=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",f),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return s.superclass=e,s.useDefaultStyles=function(){n.inject(i)},r.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=e*100+"%",s.superclass.prototype.updateDisplay.call(this)}}),s}(t.controllers.NumberController,t.dom.dom,t.utils.css,t.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),t.controllers.FunctionController=function(e,t,n){var r=function(e,n,i){r.superclass.call(this,e,n);var s=this;this.__button=document.createElement("div"),this.__button.innerHTML=i===undefined?"Fire":i,t.bind(this.__button,"click",function(e){return e.preventDefault(),s.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return r.superclass=e,n.extend(r.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),r}(t.controllers.Controller,t.dom.dom,t.utils.common),t.controllers.BooleanController=function(e,t,n){var r=function(e,n){function s(){i.setValue(!i.__prev)}r.superclass.call(this,e,n);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",s,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){var t=r.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,r.superclass.prototype.updateDisplay.call(this)}}),r}(t.controllers.Controller,t.dom.dom,t.utils.common),t.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var n=t.hex.toString(16);while(n.length<6)n="0"+n;return"#"+n}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(t.utils.common),t.color.interpret=function(e,t){var n,r,i=function(){r=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(s,function(i){if(i.litmus(e))return t.each(i.conversions,function(i,s){n=i.read(e);if(r===!1&&n!==!1)return r=n,n.conversionName=s,n.conversion=i,t.BREAK}),t.BREAK}),r},s=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!=3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!=4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return i}(t.color.toString,t.utils.common),t.GUI=t.gui.GUI=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function C(e,t,n,s){if(t[n]===undefined)throw new Error("Object "+t+' has no property "'+n+'"');var o;if(s.color)o=new l(t,n);else{var u=[t,n].concat(s.factoryArgs);o=r.apply(e,u)}s.before instanceof i&&(s.before=s.before.__li),A(e,o),p.addClass(o.domElement,"c");var a=document.createElement("span");p.addClass(a,"property-name"),a.innerHTML=o.property;var f=document.createElement("div");f.appendChild(a),f.appendChild(o.domElement);var c=k(e,f,s.before);return p.addClass(c,N.CLASS_CONTROLLER_ROW),p.addClass(c,typeof o.getValue()),L(e,c,o),e.__controllers.push(o),o}function k(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,params.before):e.__ul.appendChild(r),e.onResize(),r}function L(e,t,n){n.__li=t,n.__gui=e,d.extend(n,{options:function(t){if(arguments.length>1)return n.remove(),C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]});if(d.isArray(t)||d.isObject(t))return n.remove(),C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}});if(n instanceof a){var r=new u(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),i.apply(r,e)}}),p.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof u){var i=function(t){return d.isNumber(n.__min)&&d.isNumber(n.__max)?(n.remove(),C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=d.compose(i,n.min),n.max=d.compose(i,n.max)}else n instanceof s?(p.bind(t,"click",function(){p.fakeEvent(n.__checkbox,"click")}),p.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof o?(p.bind(t,"click",function(){p.fakeEvent(n.__button,"click")}),p.bind(t,"mouseover",function(){p.addClass(n.__button,"hover")}),p.bind(t,"mouseout",function(){p.removeClass(n.__button,"hover")})):n instanceof l&&(p.addClass(t,"color"),n.updateDisplay=d.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=d.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&j(e.getRoot(),!0),t},n.setValue)}function A(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(r!=-1){var i=n.__rememberedObjectIndecesToControllers[r];i===undefined&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t;if(n.load&&n.load.remembered){var s=n.load.remembered,o;if(s[e.preset])o=s[e.preset];else{if(!s[y])return;o=s[y]}if(o[r]&&o[r][t.property]!==undefined){var u=o[r][t.property];t.initialValue=u,t.setValue(u)}}}}function O(e,t){return document.location.href+"."+t}function M(e){var t=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),p.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",p.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",p.addClass(r,"button"),p.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",p.addClass(i,"button"),p.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",p.addClass(s,"button"),p.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?d.each(e.load.remembered,function(t,n){H(e,n,n==e.preset)}):H(e,y,!1),p.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(s);if(b){var u=document.getElementById("dg-save-locally"),a=document.getElementById("dg-local-explain");u.style.display="block";var f=document.getElementById("dg-local-storage");localStorage.getItem(O(e,"isLocal"))==="true"&&f.setAttribute("checked","checked");function l(){a.style.display=e.useLocalStorage?"block":"none"}l(),p.bind(f,"change",function(){e.useLocalStorage=!e.useLocalStorage,l()})}var c=document.getElementById("dg-new-constructor");p.bind(c,"keydown",function(e){e.metaKey&&(e.which===67||e.keyCode==67)&&w.hide()}),p.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),undefined,2),w.show(),c.focus(),c.select()}),p.bind(r,"click",function(){e.save()}),p.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),p.bind(s,"click",function(){e.revert()})}function _(e){function n(n){return n.preventDefault(),t=n.clientX,p.addClass(e.__closeButton,N.CLASS_DRAG),p.bind(window,"mousemove",r),p.bind(window,"mouseup",i),!1}function r(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function i(){p.removeClass(e.__closeButton,N.CLASS_DRAG),p.unbind(window,"mousemove",r),p.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div"),d.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var t;p.bind(e.__resize_handle,"mousedown",n),p.bind(e.__closeButton,"mousedown",n),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function D(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function P(e,t){var n={};return d.each(e.__rememberedObjects,function(r,i){var s={},o=e.__rememberedObjectIndecesToControllers[i];d.each(o,function(e,n){s[n]=t?e.initialValue:e.getValue()}),n[i]=s}),n}function H(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function B(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value==e.preset&&(e.__preset_select.selectedIndex=t)}function j(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];t?n.innerHTML=n.value+"*":n.innerHTML=n.value}function F(e){e.length!=0&&c(function(){F(e)}),d.each(e,function(e){e.updateDisplay()})}e.inject(n);var v="dg",m=72,g=20,y="Default",b=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return!1}}(),w,E=!0,S,x=!1,T=[],N=function(e){function u(){localStorage.setItem(O(t,"gui"),JSON.stringify(t.getSaveObject()))}function f(){var e=t.getRoot();e.width+=1,d.defer(function(){e.width-=1})}var t=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,v),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=d.defaults(e,{autoPlace:!0,width:N.DEFAULT_WIDTH}),e=d.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),d.isUndefined(e.load)?e.load={preset:y}:e.preset&&(e.load.preset=e.preset),d.isUndefined(e.parent)&&e.hideable&&T.push(this),e.resizable=d.isUndefined(e.parent)&&e.resizable,e.autoPlace&&d.isUndefined(e.scrollable)&&(e.scrollable=!0);var n=b&&localStorage.getItem(O(this,"isLocal"))==="true";Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return t.parent?t.getRoot().preset:e.load.preset},set:function(n){t.parent?t.getRoot().preset=n:e.load.preset=n,B(this),t.revert()}},width:{get:function(){return e.width},set:function(n){e.width=n,D(t,n)}},name:{get:function(){return e.name},set:function(t){e.name=t,i&&(i.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(n){e.closed=n,e.closed?p.addClass(t.__ul,N.CLASS_CLOSED):p.removeClass(t.__ul,N.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=n?N.TEXT_OPEN:N.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return n},set:function(e){b&&(n=e,e?p.bind(window,"unload",u):p.unbind(window,"unload",u),localStorage.setItem(O(t,"isLocal"),e))}}});if(d.isUndefined(e.parent)){e.closed=!1,p.addClass(this.domElement,N.CLASS_MAIN),p.makeSelectable(this.domElement,!1);if(b&&n){t.useLocalStorage=!0;var r=localStorage.getItem(O(this,"gui"));r&&(e.load=JSON.parse(r))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=N.TEXT_CLOSED,p.addClass(this.__closeButton,N.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{e.closed===undefined&&(e.closed=!0);var i=document.createTextNode(e.name);p.addClass(i,"controller-name");var s=k(t,i),o=function(e){return e.preventDefault(),t.closed=!t.closed,!1};p.addClass(this.__ul,N.CLASS_CLOSED),p.addClass(s,"title"),p.bind(s,"click",o),e.closed||(this.closed=!1)}e.autoPlace&&(d.isUndefined(e.parent)&&(E&&(S=document.createElement("div"),p.addClass(S,v),p.addClass(S,N.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(S),E=!1),S.appendChild(this.domElement),p.addClass(this.domElement,N.CLASS_AUTO_PLACE)),this.parent||D(t,e.width)),p.bind(window,"resize",function(){t.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){t.onResize()}),p.bind(this.__ul,"transitionend",function(){t.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){t.onResize()}),this.onResize(),e.resizable&&_(this);var a=t.getRoot();e.parent||f()};return N.toggleHide=function(){x=!x,d.each(T,function(e){e.domElement.style.zIndex=x?-999:999,e.domElement.style.opacity=x?0:1})},N.CLASS_AUTO_PLACE="a",N.CLASS_AUTO_PLACE_CONTAINER="ac",N.CLASS_MAIN="main",N.CLASS_CONTROLLER_ROW="cr",N.CLASS_TOO_TALL="taller-than-window",N.CLASS_CLOSED="closed",N.CLASS_CLOSE_BUTTON="close-button",N.CLASS_DRAG="drag",N.DEFAULT_WIDTH=245,N.TEXT_CLOSED="Close Controls",N.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(e){document.activeElement.type!=="text"&&(e.which===m||e.keyCode==m)&&N.toggleHide()},!1),d.extend(N.prototype,{add:function(e,t){return C(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return C(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;d.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&S.removeChild(this.domElement)},addFolder:function(e){if(this.__folders[e]!==undefined)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new N(t);this.__folders[e]=n;var r=k(this,n.domElement);return p.addClass(r,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top,n=0;d.each(e.__ul.childNodes,function(t){if(!e.autoPlace||t!==e.__save_row)n+=p.getHeight(t)}),window.innerHeight-t-g<n?(p.addClass(e.domElement,N.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-g+"px"):(p.removeClass(e.domElement,N.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&d.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){d.isUndefined(w)&&(w=new h,w.domElement.innerHTML=t);if(this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;d.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length==0&&M(e),e.__rememberedObjects.indexOf(t)==-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&D(this,this.width)},getRoot:function(){var e=this;while(e.parent)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=P(this)),e.folders={},d.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=P(this),j(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[y]=P(this,!0)),this.load.remembered[e]=P(this),this.preset=e,H(this,e,!0)},revert:function(e){d.each(this.__controllers,function(t){this.getRoot().load.remembered?A(e||this.getRoot(),t):t.setValue(t.initialValue)},this),d.each(this.__folders,function(e){e.revert(e)}),e||j(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e),t&&F(this.__listening)}}),N}(t.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",t.controllers.factory=function(e,t,n,r,i,s,o){return function(u,a){var f=u[a];if(o.isArray(arguments[2])||o.isObject(arguments[2]))return new e(u,a,arguments[2]);if(o.isNumber(f))return o.isNumber(arguments[2])&&o.isNumber(arguments[3])?new n(u,a,arguments[2],arguments[3]):new t(u,a,{min:arguments[2],max:arguments[3]});if(o.isString(f))return new r(u,a);if(o.isFunction(f))return new i(u,a,"");if(o.isBoolean(f))return new s(u,a)}}(t.controllers.OptionController,t.controllers.NumberControllerBox,t.controllers.NumberControllerSlider,t.controllers.StringController=function(e,t,n){var r=function(e,n){function s(){i.setValue(i.__input.value)}function o(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}r.superclass.call(this,e,n);var i=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",s),t.bind(this.__input,"change",s),t.bind(this.__input,"blur",o),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),r.superclass.prototype.updateDisplay.call(this)}}),r}(t.controllers.Controller,t.dom.dom,t.utils.common),t.controllers.FunctionController,t.controllers.BooleanController,t.utils.common),t.controllers.Controller,t.controllers.BooleanController,t.controllers.FunctionController,t.controllers.NumberControllerBox,t.controllers.NumberControllerSlider,t.controllers.OptionController,t.controllers.ColorController=function(e,t,n,r,i){function u(e,t,n,r){e.style.background="",i.each(o,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}function a(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var s=function(e,o){function c(e){v(e),t.bind(window,"mousemove",v),t.bind(window,"mouseup",h)}function h(){t.unbind(window,"mousemove",v),t.unbind(window,"mouseup",h)}function p(){var e=r(this.value);e!==!1?(f.__color.__state=e,f.setValue(f.__color.toOriginal())):this.value=f.__color.toString()}function d(){t.unbind(window,"mousemove",m),t.unbind(window,"mouseup",d)}function v(e){e.preventDefault();var n=t.getWidth(f.__saturation_field),r=t.getOffset(f.__saturation_field),i=(e.clientX-r.left+document.body.scrollLeft)/n,s=1-(e.clientY-r.top+document.body.scrollTop)/n;return s>1?s=1:s<0&&(s=0),i>1?i=1:i<0&&(i=0),f.__color.v=s,f.__color.s=i,f.setValue(f.__color.toOriginal()),!1}function m(e){e.preventDefault();var n=t.getHeight(f.__hue_field),r=t.getOffset(f.__hue_field),i=1-(e.clientY-r.top+document.body.scrollTop)/n;return i>1?i=1:i<0&&(i=0),f.__color.h=i*360,f.setValue(f.__color.toOriginal()),!1}s.superclass.call(this,e,o),this.__color=new n(this.getValue()),this.__temp=new n(0);var f=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){e.keyCode===13&&p.call(this)}),t.bind(this.__input,"blur",p),t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(f.__selector,"drag")})});var l=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(l.style,{width:"100%",height:"100%",background:"none"}),u(l,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),a(this.__hue_field),i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",c),t.bind(this.__field_knob,"mousedown",c),t.bind(this.__hue_field,"mousedown",function(e){m(e),t.bind(window,"mousemove",m),t.bind(window,"mouseup",d)}),this.__saturation_field.appendChild(l),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};s.superclass=e,i.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=r(this.getValue());if(e!==!1){var t=!1;i.each(n.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,o=255-s;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,u(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];return s}(t.controllers.Controller,t.dom.dom,t.color.Color=function(e,t,n,r){function s(e,t,n){Object.defineProperty(e,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(u(this,t,n),this.__state[t])},set:function(e){this.__state.space!=="RGB"&&(u(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(a(this),this.__state[t])},set:function(e){this.__state.space!=="HSV"&&(a(this),this.__state.space="HSV"),this.__state[t]=e}})}function u(e,n,i){if(e.__state.space==="HEX")e.__state[n]=t.component_from_hex(e.__state.hex,i);else{if(e.__state.space!=="HSV")throw"Corrupted color state";r.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:n.s,v:n.v}),r.isNaN(n.h)?r.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var i=function(){this.__state=e.apply(this,arguments);if(this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return i.COMPONENTS=["r","g","b","h","s","v","hex","a"],r.extend(i.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),s(i.prototype,"r",2),s(i.prototype,"g",1),s(i.prototype,"b",0),o(i.prototype,"h"),o(i.prototype,"s"),o(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(i.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),i}(t.color.interpret,t.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),s=n*(1-t),o=n*(1-i*t),u=n*(1-(1-i)*t),a=[[n,u,s],[o,n,s],[s,n,u],[s,o,n],[u,s,n],[n,s,o]][r];return{r:a[0]*255,g:a[1]*255,b:a[2]*255}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),s=i-r,o,u;return i==0?{h:NaN,s:0,v:0}:(u=s/i,e==i?o=(t-n)/s:t==i?o=2+(n-e)/s:o=4+(e-t)/s,o/=6,o<0&&(o+=1),{h:o*360,s:u,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n),r},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,n,r){return r<<(e=n*8)|t&~(255<<e)}}}(),t.color.toString,t.utils.common),t.color.interpret,t.utils.common),t.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),t.dom.CenteredDiv=function(e,t){function r(e){console.log(e)}var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(t.dom.dom,t.utils.common),t.dom.dom,t.utils.common),typeof define=="function"&&define.amd?define("happy/_libs/datgui",[],function(){return t.GUI}):typeof module!="undefined"&&module.exports?module.exports=t.GUI:e.GUI=t.GUI}(this),define("WAAX",[],function(){var e;(function(){if(!1===/chrome/.test(navigator.userAgent.toLowerCase()))throw alert("Sorry. Your browser is not compatible with WAAX. Use Chrome 24+ to use WAAX."),"[WAAX] Error: Incompatible browser.";if(24>parseInt(window.navigator.appVersion.match(/Chrome\/(.*?) /)[1],10))throw alert("Sorry. Chrome 24+ is required to use WAAX."),"[WAAX] Error: Outdated Chrome."})();var e=e||Object.create(null,{_version:{value:{number:0,revision:5}},_context:{value:new webkitAudioContext},now:{get:function(){return this._context.currentTime},set:function(){}},version:{get:function(){return this._version.revision},set:function(){}},getContext:{value:function(){return this._context}},Types:{value:Object.freeze({Unit:"Unit.",Generator:"Generator.",Processor:"Processor.",Analyzer:"Analyzer."})},Template:{value:Object.create(null),writable:!0},Internal:{value:Object.create(null),writable:!0},Unit:{value:Object.create(null),writable:!0}});return console.log("[WAAX] Starting... (r"+e.version+")"),e.Unit.Common=function(){Object.defineProperties(this,{_label:{value:e.Types.Unit,enumerable:!1,writable:!0}})},e.Unit.Common.prototype=Object.create(null,{label:{enumerable:!1,get:function(){return this._label},set:function(e){this._label=e}},params:{enumerable:!1,get:function(){var e=Object.create(null),t;for(t in this)e[t]=this[t];return e},set:function(t){"object"!=typeof t&&e.error(this,"invalid JSON.");for(var n in t)void 0!==this[n]?this[n]=t[n]:e.warn(this,n+" is not an available property.")}},toString:{value:function(){var e=this.label;return e+=" <pre>"+JSON.stringify(this.params,null,2)+"</pre>"}}}),e.Unit.Generator=function(){e.Unit.Common.call(this),Object.defineProperties(this,{_outputGain:{value:e._context.createGain()},_outlet:{value:e._context.createGain()},_active:{value:!0,writable:!0}}),this._outputGain.connect(this._outlet),this.label+=e.Types.Generator,e.bindParam.call(this,"mgain",this._outputGain.gain)},e.Unit.Generator.prototype=Object.create(e.Unit.Common.prototype,{to:{value:function(t){if("[object GainNode]"===Object.prototype.toString.call(t._inlet))return this._outlet.connect(t._inlet),t;e.error(this,"invalid inlet node in target unit.")}},cut:{value:function(){this._outlet.disconnect()}},connect:{value:function(e){this._outlet.connect(e)}},gain:{enumerable:!0,get:function(){return this._outputGain.gain.value},set:function(e){this._outputGain.gain.value=e}},active:{enumerable:!0,get:function(){return this._active},set:function(e){"boolean"==typeof e&&((this._active=e)?this._outputGain.connect(this._outlet):this._outputGain.disconnect())}}}),e.Unit.Processor=function(){e.Unit.Common.call(this),Object.defineProperties(this,{_inlet:{value:e._context.createGain()},_inputGain:{value:e._context.createGain()},_outputGain:{value:e._context.createGain()},_outlet:{value:e._context.createGain()},_bypass:{value:!1,writable:!0}}),this._inlet.connect(this._inputGain),this._outputGain.connect(this._outlet),this.label+=e.Types.Processor,e.bindParam.call(this,"mgain",this._outputGain.gain)},e.Unit.Processor.prototype=Object.create(e.Unit.Common.prototype,{to:{value:function(t){if("[object GainNode]"===Object.prototype.toString.call(t._inlet))return this._outlet.connect(t._inlet),t;e.error(this,"invalid inlet node in target unit.")}},cut:{value:function(){this._outlet.disconnect()}},connect:{value:function(e){this._outlet.connect(e)}},gain:{enumerable:!0,get:function(){return this._outputGain.gain.value},set:function(e){this._outputGain.gain.value=e}},bypass:{enumerable:!0,get:function(){return this._bypass},set:function(e){"boolean"==typeof e&&((this._bypass=e)?(this._outputGain.disconnect(),this._inlet.connect(this._outlet)):(this._inlet.disconnect(),this._inlet.connect(this._inputGain),this._outputGain.connect(this._outlet)))}}}),e.Unit.Analyzer=function(){e.Unit.Common.call(this),Object.defineProperties(this,{_inlet:{value:e._context.createGain()},_inputGain:{value:e._context.createGain()},_analyzer:{value:e._context.createAnalyser()},_active:{value:!0,writable:!0}}),this._inlet.connect(this._inputGain),this._inputGain.connect(this._analyzer),this.label+=e.Types.Analyzer,e.bindParam.call(this,"mgain",this._inputGain.gain)},e.Unit.Analyzer.prototype=Object.create(e.Unit.Common.prototype,{gain:{enumerable:!0,get:function(){return this._inputGain.gain.value},set:function(e){this._inputGain.gain.value=e}},active:{enumerable:!0,get:function(){return this._active},set:function(e){"boolean"==typeof e&&((this._active=e)?this._inlet.connect(this._inputGain):this._inlet.disconnect())}}}),e._at=null,e.at=function(t,n){e._at=t+e.now,n.call(),e._at=null},e.bindParam=function(t,n){var r=this[t+"_"]=n;this[t]=function(t,n,i){if(void 0===t)return r.value;var s=e._at?e._at:e.now;switch(i){case void 0:r.setValueAtTime(t,s);break;case"line":r.linearRampToValueAtTime(t,s+n);break;case"expo":r.exponentialRampToValueAtTime(t,s+n);break;default:r.setValueAtTime(t,s)}return this}},e.link=function(){for(var e=arguments.length-1;1<=e;--e)arguments[e-1].to(arguments[e])},e.cut=function(){for(var e=arguments.length-1;0<=e;--e)arguments[e].cut()},Object.defineProperties(e,{PI:{value:Math.PI},TWOPI:{value:2*Math.PI},EPS:{value:Number.MIN_VALUE},NoteName:{value:{A0:21,B0:23,C1:24,D1:26,E1:28,F1:29,G1:31,A1:33,B1:35,C2:36,D2:38,E2:40,F2:41,G2:43,A2:45,B2:47,C3:48,D3:50,E3:52,F3:53,G3:55,A3:57,B3:59,C4:60,D4:62,E4:64,F4:65,G4:67,A4:69,B4:71,C5:72,D5:74,E5:76,F5:77,G5:79,A5:81,B5:83,C6:84,D6:86,E6:88,F6:89,G6:91,A6:93,B6:95,C7:96,D7:98,E7:100,F7:101,G7:103,A7:105,B7:107,C8:108}},random2f:{value:function(e,t){return e+Math.random()*(t-e)}},random2:{value:function(e,t){return Math.round(e+Math.random()*(t-e))}},pitch2freq:{value:function(e){return 440*Math.pow(2,(Math.floor(e)-69)/12)}},freq2pitch:{value:function(e){return Math.floor(69+12*Math.log(e/440)/Math.log(2))}},lin2db:{value:function(e){return 20*(1e-5<e?Math.log(e)/Math.LN10:-5)}},db2lin:{value:function(e){return Math.pow(10,e/20)}},info:{value:function(e,t){console.log("[WX:"+e.label+"] Info: "+t)}},warn:{value:function(e,t){console.log("[WX:"+e.label+"] Warning: "+t)}},error:{value:function(e,t){throw Error("[WX:"+e.label+"] Error: "+t)}}}),e.Internal.DualLevelDetector=function(){Object.defineProperties(this,{_fs:{enumerable:!1,writable:!1,value:e._context.sampleRate},_attackFast:{enumerable:!1,writable:!0,value:1},_releaseFast:{enumerable:!1,writable:!0,value:1},_levelFast:{enumerable:!1,writable:!0,value:0},_attackSlow:{enumerable:!1,writable:!0,value:1},_releaseSlow:{enumerable:!1,writable:!0,value:1},_levelSlow:{enumerable:!1,writable:!0,value:0}}),this.reset()},e.Internal.DualLevelDetector.prototype=Object.create(null,{attack:{enumerable:!0,get:function(){return this._attackFast},set:function(e){this._attackFast=1-Math.exp(-1/(e*this._fs))}},release:{enumerable:!0,get:function(){return this._releaseFast},set:function(e){this._releaseFast=1-Math.exp(-1/(e*this._fs))}},reset:{enumerable:!1,value:function(){this._attackFast=1-Math.exp(-1/(.125*this._fs)),this._releaseFast=1-Math.exp(-1/(.5*this._fs)),this._attackSlow=1-Math.exp(-1/(.25*this._fs)),this._releaseSlow=1-Math.exp(-1/this._fs),this._levelSlow=this._levelFast=0}},process:{value:function(e){return e=Math.abs(e),this._levelSlow=e>this._levelSlow?this._levelSlow+this._attackSlow*(e-this._levelSlow):this._levelSlow+this._releaseSlow*(e-this._levelSlow),this._levelFast=e>this._levelFast?this._levelFast+this._attackFast*(e-this._levelFast):this._levelFast+this._releaseFast*(this._levelSlow-this._levelFast)}}}),e.Internal.RingBuffer=function(e,t){var n=e||512;bn=t||8,Object.defineProperties(this,{_blockSize:{enumerable:!1,writable:!1,value:n},_bufferSize:{enumerable:!1,writable:!1,value:n*bn},_buffer:{enumerable:!1,writable:!0,value:void 0},_writer:{enumerable:!1,writable:!0,value:0},_reader:{enumerable:!1,writable:!0,value:0}}),this._buffer=new Float32Array(this._bufferSize)},e.Internal.RingBuffer.prototype=Object.create(null,{writeBlock:{enumerable:!0,value:function(e){for(var t=this._writer+this._blockSize,n=0;this._writer<t;)this._buffer[this._writer++]=e[n++];this._writer==this._bufferSize&&(this._writer=0),this._reader=this._writer}},copyBuffertoArray:{enumerable:!0,value:function(e){for(var t=0,n=this._bufferSize,r=this._reader;t<n;)e[t++]=this._buffer[r++],r==n&&(r=0)}}}),function(){var t=e._context.sampleRate,n=5*t,r=new Float32Array(n);e.Template.WhiteNoise=e._context.createBuffer(1,n,t);for(t=0;t<n;++t)r[t]=2*Math.random()-1;e.Template.WhiteNoise.getChannelData(0).set(r,0)}(),e.Loop=function(e,t,n){Object.defineProperties(this,{_index:{writable:!0,value:0},_repetition:{value:t||0},_interval:{writable:!0,value:n||1},_next:{writable:!0,value:0},_checkup:{value:1e3/30},_ahead:{value:1},_infinite:{writable:!0,value:!1},_continue:{writable:!0,value:!0},_timerId:{writable:!0,value:null},_callback:{writable:!0,value:e||function(){}}}),this._infinite=0===this._repetition?!0:!1},e.Loop.prototype=Object.create(null,{_loop:{value:function(){this._next<e.now+this._ahead&&(this._callback.call(this,this._next,this._index),this._next+=this._interval,this._infinite||(this._continue=++this._index>=this._repetition?!1:!0));if(this._continue){var t=this;this._timerId=setTimeout(function(){t._loop()},this._checkup)}}},start:{value:function(){clearTimeout(this._timerId),this._loop()}},stop:{value:function(){clearTimeout(this._timerId),this._continue=!1}}}),e.LFO=function(t){e.Unit.Generator.call(this),this.label+="LFO",Object.defineProperties(this,{_lfo:{enumerable:!1,writable:!1,value:e._context.createOscillator()},_defaults:{value:{rate:5,shape:"sine",depth:1}}}),this._lfo.connect(this._outputGain),this._lfo.noteOn(0),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.LFO.prototype=Object.create(e.Unit.Generator.prototype,{rate:{enumerable:!0,get:function(){return this._lfo.frequency.value},set:function(e){e=Math.max(0,Math.min(20,e)),this._lfo.frequency.value=e}},depth:{enumerable:!0,get:function(){return this._outputGain.gain.value},set:function(e){this._outputGain.gain.value=e}},shape:{enumerable:!0,get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}}),e.Noise=function(t){e.Unit.Generator.call(this),this.label+="Noise",Object.defineProperties(this,{_source:{enumerable:!1,writable:!1,value:e._context.createBufferSource()},_type:{enumerable:!1,writable:!0,value:"white"},_defaults:{value:{type:"white"}}}),this._source.connect(this._outputGain),this._source.buffer=e.Template.WhiteNoise,this._source.loop=1,this._source.noteOn(0),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Noise.prototype=Object.create(e.Unit.Generator.prototype,{type:{enumerable:!0,get:function(){return this._type},set:function(e){this._type=e}}}),e.Oscil=function(t){e.Unit.Generator.call(this),Object.defineProperties(this,{_oscil:{enumerable:!1,writable:!1,value:e._context.createOscillator()},_defaults:{value:{frequency:440,type:"sine",gain:1}},modulationTarget:{enumerable:!0,writable:!0,value:{frequency:null,gain:null}}}),this._oscil.connect(this._outputGain),this._oscil.start(0),this.params=this._defaults,"object"==typeof t&&(this.params=t),this.label+="Oscil",e.bindParam.call(this,"mfreq",this._oscil.frequency)},e.Oscil.prototype=Object.create(e.Unit.Generator.prototype,{frequency:{enumerable:!0,get:function(){return this._oscil.frequency.value},set:function(e){this._oscil.frequency.cancelScheduledValues(0),this._oscil.frequency.setValueAtTime(e,0)}},glide:{value:function(t,n){var r=e._context.currentTime,i=this._oscil.frequency;i.setValueAtTime(i.value,r),i.linearRampToValueAtTime(t,r+n)}},pitch:{enumerable:!0,get:function(){return e.freq2pitch(this._oscil.frequency.value)},set:function(t){this._oscil.frequency.value=e.pitch2freq(t)}},type:{enumerable:!0,get:function(){return this._oscil.type},set:function(e){if(void 0!==e){switch(e){case"sine":case 0:e=0;break;case"square":case 1:e=1;break;case"sawtooth":case 2:e=2;break;case"triangle":case 3:e=3;break;default:e=0}this._oscil.type=e}}}}),e.ImpTrain=function(t){e.Unit.Generator.call(this),this.label+="ImpTrain",Object.defineProperties(this,{_generator:{enumerable:!1,writable:!1,value:e._context.createScriptProcessor(256,1,1)},_period:{enumerable:!1,writable:!0,value:0},_phase:{enumerable:!1,writable:!0,value:0},_dc:{enumerable:!1,writable:!0,value:0},_frequency:{enumerable:!1,writable:!0,value:440},_defaults:{value:{frequency:440,gain:1}}});var n=this;this._generator.onaudioprocess=function(e){n._callback(e)},this._generator.connect(this._outputGain),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.ImpTrain.prototype=Object.create(e.Unit.Generator.prototype,{_callback:{value:function(e){e=e.outputBuffer.getChannelData(0);for(var t=0;256>t;++t){var n=0;0>this._phase&&(n=1-(1+this._phase),this._phase+=this._period),e[t]=n-this._dc,this._phase-=1}}},frequency:{enumerable:!0,get:function(){return this._frequency},set:function(t){this._frequency=t,this._period=e._context.sampleRate/this._frequency,this._dc=1/this._period,this._phase=this._period}}}),e.Sampler=function(t){e.Unit.Generator.call(this),this.label+="Sampler",Object.defineProperties(this,{_buffer:{writable:!0,value:void 0},_player:{writable:!0,value:void 0},_url:{writable:!0,value:""},_basePitch:{writable:!0,value:60},_loaded:{writable:!0,value:!1},_defaults:{value:{basePitch:60}}}),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Sampler.prototype=Object.create(e.Unit.Generator.prototype,{source:{enumerable:!0,get:function(){return this._url},set:function(t){if(void 0===t)return e.error(this,"invalid audio file path."),!1;var n=this,r=new XMLHttpRequest;return r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){try{n._buffer=e._context.createBuffer(r.response,!0),n._loaded=!0,e.info(n,"loaded: "+t)}catch(i){e.error(n,"file loading error: "+t+" ("+i.message+")")}},r.send(),this._url=t,!0}},basePitch:{enumerable:!0,get:function(){return this._basePitch},set:function(e){this._basePitch=e}},noteOn:{value:function(t){this._loaded?(this._player=e._context.createBufferSource(),this._player.buffer=this._buffer,this._player.connect(this._outputGain),void 0!==t&&(t=Math.pow(2,(t-this._basePitch)/12),this._player.playbackRate.setValueAtTime(t,0)),this._player.start(0)):e.error(this,"sampler is not ready.")}},noteOff:{value:function(e){this._player&&this._player.stop(e||0)}}}),e.ADSR=function(t){e.Unit.Processor.call(this),this.label+="ADSR",Object.defineProperties(this,{_a:{writable:!0,value:.005},_d:{writable:!0,value:.015},_tauDecay:{writable:!0,value:-0.015/Math.log(.001)},_s:{writable:!0,value:.35},_r:{writable:!0,value:.05},_tauRelease:{writable:!0,value:-0.05/Math.log(.001)},_running:{writable:!0,value:!1},_defaults:{value:{a:.015,d:.015,s:.3,r:.05,gain:1}}}),this._inputGain.connect(this._outputGain),this._inputGain.gain.value=0,this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.ADSR.prototype=Object.create(e.Unit.Processor.prototype,{a:{enumerable:!0,get:function(){return this._a},set:function(e){this._a=e}},d:{enumerable:!0,get:function(){return this._d},set:function(e){this._d=e,this._tauDecay=-this._d/Math.log(.001)}},s:{enumerable:!0,get:function(){return this._s},set:function(e){this._s=e}},r:{enumerable:!0,get:function(){return this._r},set:function(e){this._r=e,this._tauRelease=-this._r/Math.log(.001)}},running:{enumerable:!0,get:function(){return this._running},set:function(){}},noteOn:{value:function(t){t=t||e.now;var n=this._inputGain.gain;n.cancelScheduledValues(t),n.setValueAtTime(0,t),n.linearRampToValueAtTime(1,t+this._a),n.setTargetValueAtTime(this._s,t+this._a,this._tauDecay),this._running=!0}},noteOff:{value:function(t){t=t||e.now;var n=this._inputGain.gain;n.cancelScheduledValues(t),n.setTargetValueAtTime(0,t,this._tauRelease),this._running=!1}}}),e.C2=function(t){e.Unit.Processor.call(this),this.label+="C2",Object.defineProperties(this,{_threshold:{enumerable:!1,writable:!0,value:e.db2lin(-12)},_ratio:{enumerable:!1,writable:!0,value:4},_iratio:{enumerable:!1,writable:!0,value:1/(this._ratio-1)},_makeup:{enumerable:!1,writable:!0,value:e.db2lin(0)},_detector:{enumerable:!1,writable:!1,value:new e.Internal.DualLevelDetector},_processor:{enumerable:!1,writable:!1,value:e._context.createScriptProcessor(256,2,2)},_defaults:{value:{threshold:-12,ratio:4,attack:.01,release:.25,makeup:8}}});var n=this;this._processor.onaudioprocess=function(e){n._callback(e)},this._inputGain.connect(this._processor),this._processor.connect(this._outputGain),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.C2.prototype=Object.create(e.Unit.Processor.prototype,{_callback:{value:function(t){var n,r=t.inputBuffer.getChannelData(0),i=t.inputBuffer.getChannelData(1),s=t.outputBuffer.getChannelData(0);t=t.outputBuffer.getChannelData(1);for(var o=0;256>o;++o)n=Math.max(Math.abs(r[o]),Math.abs(i[o])),n=this._detector.process(n),n=e.lin2db(n/this._threshold),n=0>=n?0:n*this._iratio,n=e.db2lin(n),s[o]=r[o]*n*this._makeup,t[o]=i[o]*n*this._makeup}},threshold:{enumerable:!0,get:function(){return e.lin2db(this._threshold)},set:function(t){this._threshold=e.db2lin(t)}},ratio:{enumerable:!0,get:function(){return this._ratio},set:function(e){this._ratio=e,this._iratio=1/(this._ratio-1)}},attack:{enumerable:!0,get:function(){return this._detector.attack},set:function(e){this._detector.attack=e}},release:{enumerable:!0,get:function(){return this._detector.release},set:function(e){this._detector.release=e}},makeup:{enumerable:!0,get:function(){return e.lin2db(this._makeup)},set:function(t){this._makeup=e.db2lin(t)}}}),e.Comp=function(t){e.Unit.Processor.call(this),this.label+="Comp",Object.defineProperties(this,{_comp:{enumerable:!1,writable:!1,value:e._context.createDynamicsCompressor()},_defaults:{value:{threshold:-12,ratio:4,knee:.5,attack:.01,release:.25}}}),this._inputGain.connect(this._comp),this._comp.connect(this._outputGain),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Comp.prototype=Object.create(e.Unit.Processor.prototype,{threshold:{enumerable:!0,get:function(){return this._comp.threshold.value},set:function(e){this._comp.threshold.value=e}},ratio:{enumerable:!0,get:function(){return this._comp.ratio.value},set:function(e){this._comp.ratio.value=e}},knee:{enumerable:!0,get:function(){return this._comp.knee.value},set:function(e){this._comp.knee.value=e}},attack:{enumerable:!0,get:function(){return this._comp.attack.value},set:function(e){this._comp.attack.value=e}},release:{enumerable:!0,get:function(){return this._comp.release.value},set:function(e){this._comp.release.value=e}}}),e.ConVerb=function(t){e.Unit.Processor.call(this),this.label+="ConVerb",Object.defineProperties(this,{_convolver:{enumerable:!1,writable:!1,value:e._context.createConvolver()},_dry:{enumerable:!1,writable:!1,value:e._context.createGain()},_wet:{enumerable:!1,writable:!1,value:e._context.createGain()},_url:{enumerable:!1,writable:!0,value:null},_defaults:{value:{source:null,mix:.25}}}),this._inputGain.connect(this._convolver),this._inputGain.connect(this._dry),this._convolver.connect(this._wet),this._dry.connect(this._outputGain),this._wet.connect(this._outputGain),"object"==typeof t&&(this.params=t)},e.ConVerb.prototype=Object.create(e.Unit.Processor.prototype,{source:{enumerable:!0,get:function(){return this._url},set:function(t){if(void 0===t||null===t)return e.error(this,"invalid IR file path."),!1;var n=this,r=new XMLHttpRequest;return r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){try{n._convolver.buffer=e._context.createBuffer(r.response,!0),e.info(n,"loaded: "+t)}catch(i){e.error(n,"file loading error: "+t+" ("+i.message+")")}},r.send(),this._url=t,!0}},mix:{enumerable:!0,get:function(){return this._wet.gain.value},set:function(e){this._wet.gain.value=e,this._dry.gain.value=1-e}}}),e.Fader=function(t){e.Unit.Processor.call(this),this.label+="Fader",Object.defineProperties(this,{_muted:{enumerable:!1,writable:!0,value:!1},_defaults:{value:{db:0}}}),this._inputGain.connect(this._outputGain),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Fader.prototype=Object.create(e.Unit.Processor.prototype,{mute:{enumerable:!0,get:function(){return this._muted},set:function(e){!0===e?(this._muted=!0,this._inputGain.gain.value=0):(this._muted=!1,this._inputGain.gain.value=1)}},db:{enumerable:!0,get:function(){return e.lin2db(this._outputGain.gain.value)},set:function(t){this._outputGain.gain.value=e.db2lin(t)}}}),e.DAC=new e.Fader,e.DAC.connect(e._context.destination),e.LPF=function(t){e.Unit.Processor.call(this),this.label+="LPF",Object.defineProperties(this,{_lpf:{enumerable:!1,writable:!1,value:e._context.createBiquadFilter()},_cutoff:{writable:!0,value:1e3},_Q:{writable:!0,value:10},_defaults:{value:{cutoff:1e3,Q:10}}}),this._inputGain.connect(this._lpf),this._lpf.connect(this._outputGain),this._lpf.type=0,this.params=this._defaults,"object"==typeof t&&(this.params=t),e.bindParam.call(this,"mcutoff",this._lpf.frequency),e.bindParam.call(this,"mQ",this._lpf.Q)},e.LPF.prototype=Object.create(e.Unit.Processor.prototype,{cutoff:{enumerable:!0,get:function(){return this._lpf.frequency.value},set:function(e){this._lpf.frequency.value=e}},Q:{enumerable:!0,get:function(){return this._lpf.Q.value},set:function(){this._lpf.Q.value=this._Q}}}),e.ModLPF=function(t){e.Unit.Processor.call(this),this.label+="ModLPF",Object.defineProperties(this,{_lpf1:{enumerable:!1,writable:!1,value:e._context.createBiquadFilter()},_lpf2:{enumerable:!1,writable:!1,value:e._context.createBiquadFilter()},_cutoff:{writable:!0,value:1e3},_Q:{writable:!0,value:10},_a:{writable:!0,value:.005},_d:{writable:!0,value:.015},_tauDecay:{writable:!0,value:-0.015/Math.log(.001)},_s:{writable:!0,value:.35},_r:{writable:!0,value:.015},_tauRelease:{writable:!0,value:-0.05/Math.log(.001)},_running:{writable:!0,value:!1},_range:{writable:!0,value:1e3},_defaults:{value:{cutoff:1e3,Q:10,range:1e3,a:.015,d:.015,s:.3,r:.05}}}),this._inputGain.connect(this._lpf1),this._lpf1.connect(this._lpf2),this._lpf2.connect(this._outputGain),this._lpf1.type=this._lpf2.type=0,this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.ModLPF.prototype=Object.create(e.Unit.Processor.prototype,{cutoff:{enumerable:!0,get:function(){return this._cutoff},set:function(e){this._cutoff=e}},Q:{enumerable:!0,get:function(){return this._Q},set:function(e){this._Q=e,this._lpf1.Q.value=this._Q,this._lpf2.Q.value=this._Q}},a:{enumerable:!0,get:function(){return this._a},set:function(e){this._a=e}},d:{enumerable:!0,get:function(){return this._d},set:function(e){this._d=e,this._tauDecay=-this._d/Math.log(.001)}},s:{enumerable:!0,get:function(){return this._s},set:function(e){this._s=e}},r:{enumerable:!0,get:function(){return this._r},set:function(e){this._r=e,this._tauRelease=-this._r/Math.log(.001)}},running:{enumerable:!0,get:function(){return this._running}},range:{enumerable:!0,get:function(){return this._range},set:function(e){this._range=e}},noteOn:{value:function(t){t=t||e.now;var n=this._lpf1.frequency,r=this._lpf2.frequency;n.cancelScheduledValues(t),n.setValueAtTime(this._cutoff,t),r.cancelScheduledValues(t),r.setValueAtTime(this._cutoff,t);var i=this._cutoff+this._range;n.linearRampToValueAtTime(i,t+this._a),n.setTargetValueAtTime(i*this._s,t+this._a,this._tauDecay),r.linearRampToValueAtTime(i,t+this._a),r.setTargetValueAtTime(i*this._s,t+this._a,this._tauDecay),this._running=!0}},noteOff:{value:function(t){t=t||e.now;var n=this._lpf1.frequency,r=this._lpf2.frequency;n.cancelScheduledValues(t),r.cancelScheduledValues(t),n.setTargetValueAtTime(this._cutoff,t,this._tauRelease),r.setTargetValueAtTime(this._cutoff,t,this._tauRelease),this._running=!1}}}),e.TwinDelay=function(t){e.Unit.Processor.call(this),this.label+="TwinDelay",Object.defineProperties(this,{_delayL:{enumerable:!1,writable:!1,value:e._context.createDelay()},_delayR:{enumerable:!1,writable:!1,value:e._context.createDelay()},_merger:{enumerable:!1,writable:!1,value:e._context.createChannelMerger(2)},_fbL:{enumerable:!1,writable:!1,value:e._context.createGain()},_fbR:{enumerable:!1,writable:!1,value:e._context.createGain()},_crosstalkL:{enumerable:!1,writable:!1,value:e._context.createGain()},_crosstalkR:{enumerable:!1,writable:!1,value:e._context.createGain()},_dry:{enumerable:!1,writable:!1,value:e._context.createGain()},_wet:{enumerable:!1,writable:!1,value:e._context.createGain()},_defaults:{value:{delayTimeLeft:.125,delayTimeRight:.25,feedbackLeft:.25,feedbackRight:.25,crosstalk:.1,mix:.5}}}),this._inputGain.connect(this._delayL),this._inputGain.connect(this._delayR),this._inputGain.connect(this._dry),this._delayL.connect(this._fbL),this._delayR.connect(this._fbR),this._fbL.connect(this._delayL),this._fbR.connect(this._delayR),this._fbL.connect(this._crosstalkR),this._fbR.connect(this._crosstalkL),this._crosstalkR.connect(this._delayR),this._crosstalkL.connect(this._delayL),this._delayL.connect(this._merger,0,0),this._delayR.connect(this._merger,0,1),this._merger.connect(this._wet),this._dry.connect(this._outputGain),this._wet.connect(this._outputGain),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.TwinDelay.prototype=Object.create(e.Unit.Processor.prototype,{delayTimeLeft:{enumerable:!0,get:function(){return this._delayL.delayTime.value},set:function(e){this._delayL.delayTime.value=e}},delayTimeRight:{enumerable:!0,get:function(){return this._delayR.delayTime.value},set:function(e){this._delayR.delayTime.value=e}},feedbackLeft:{enumerable:!0,get:function(){return this._fbL.gain.value},set:function(e){this._fbL.gain.value=e}},feedbackRight:{enumerable:!0,get:function(){return this._fbR.gain.value},set:function(e){this._fbR.gain.value=e}},crosstalk:{enumerable:!0,get:function(){return this._crosstalkL.gain.value},set:function(e){this._crosstalkL.gain.value=e,this._crosstalkR.gain.value=e}},mix:{enumerable:!0,get:function(){return this._wet.gain.value},set:function(e){this._wet.gain.value=e,this._dry.gain.value=1-e}}}),e.Waveform=function(t){e.Unit.Analyzer.call(this),this.label+="Waveform",Object.defineProperties(this,{_context2D:{writable:!0,value:null},_buffer:{writable:!0,value:new Uint8Array(this._analyzer.frequencyBinCount)},_pause:{writable:!0,value:!1},_autoClear:{writable:!0,value:!0},_defaults:{value:{}}}),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Waveform.prototype=Object.create(e.Unit.Analyzer.prototype,{_updateSize:{value:function(){this._unitX=this._context2D.canvas.width/this._buffer.length,this._scaleY=this._context2D.canvas.height}},context:{enumerable:!0,get:function(){return this._context2D},set:function(t){void 0===t||null===t?e.error(this,"invalid drawing context."):(this._context2D=t,this._updateSize())}},pause:{enumerable:!0,get:function(){return this._pause},set:function(e){this._pause=e}},autoClear:{enumerable:!0,get:function(){return this._autoClear},set:function(e){this._autoClear=e}},draw:{value:function(){if(!this._pause){this._analyzer.getByteTimeDomainData(this._buffer);var e=this._context2D;this._autoClear&&e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.moveTo(0,(1-this._buffer[0]/255)*this._scaleY);for(var t=1,n=this._buffer.length;t<n;++t)e.lineTo(t*this._unitX,(1-this._buffer[t]/255)*this._scaleY);e.stroke()}}}}),e.Spectrum=function(t){e.Unit.Analyzer.call(this),this.label+="Spectrum",Object.defineProperties(this,{_context2D:{writable:!0,value:null},_buffer:{writable:!0,value:new Uint8Array(this._analyzer.frequencyBinCount)},_pause:{writable:!0,value:!1},_autoClear:{writable:!0,value:!0},_defaults:{value:{}}}),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Spectrum.prototype=Object.create(e.Unit.Analyzer.prototype,{_updateSize:{value:function(){this._unitX=this._context2D.canvas.width/this._buffer.length,this._scaleY=this._context2D.canvas.height}},context:{enumerable:!0,get:function(){return this._context2D},set:function(t){void 0===t||null===t?e.error(this,"invalid drawing context."):(this._context2D=t,this._updateSize())}},pause:{enumerable:!0,get:function(){return this._pause},set:function(e){this._pause=e}},autoClear:{enumerable:!0,get:function(){return this._autoClear},set:function(e){this._autoClear=e}},draw:{value:function(){if(!this._pause){this._analyzer.getByteFrequencyData(this._buffer);var e=this._context2D;this._autoClear&&e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.moveTo(0,(1-this._buffer[t]/255)*this._scaleY);for(var t=1,n=this._buffer.length;t<n;++t)e.lineTo(t*this._unitX,(1-this._buffer[t]/255)*this._scaleY);e.stroke()}}}}),e.Visualizer=function(t){e.Unit.Analyzer.call(this),this.label+="Visualizer",Object.defineProperties(this,{_drawCallback:{writable:!0,value:function(){}},_context:{writable:!0,value:null},_buffer:{writable:!0,value:new Uint8Array(this._analyzer.frequencyBinCount)},_width:{writable:!0,value:600},_height:{writable:!0,value:300},_pause:{writable:!0,value:!1},_defaults:{value:{}}}),this.params=this._defaults,"object"==typeof t&&(this.params=t)},e.Visualizer.prototype=Object.create(e.Unit.Analyzer.prototype,{context:{enumerable:!0,get:function(){return this._context},set:function(t){void 0===t?e.error(this,"invalid drawing context. (undefined)"):(this._context=t,this.updateSize())}},pause:{enumerable:!0,get:function(){return this._pause},set:function(e){this._pause=e}},bufferSize:{enumerable:!0,get:function(){return this._buffer.length},set:function(){}},onRender:{set:function(e){this._drawCallback=e},get:function(){return this._drawCallback}},updateSize:{value:function(){this._width=this._context.canvas.width,this._height=this._context.canvas.height}},draw:{value:function(){this._pause||(this._analyzer.getByteTimeDomainData(this._buffer),this._drawCallback.call(this,this._buffer,this._context,this._width,this._height))}}}),e.UIManager=Object.create(null,{selected:{writable:!0,value:null},onClicked:{writable:!0,value:null},onDragged:{writable:!0,value:null},onReleased:{writable:!0,value:null},rad2degFactor:{value:180/Math.PI}}),e.UISliderH=function(e){return Object.defineProperties(this,{_container:{value:document.createElement("div")},_placeholder:{value:document.createElement("div")},_control:{value:document.createElement("div")},_label:{value:document.createElement("div")},_rect:{writable:!0,value:null},_pos:{writable:!0,value:{x:0,y:0}},_prev:{writable:!0,value:{x:0,y:0}},_params:{writable:!0,value:{val:e.value||0,offset:e.offset||0,scale:e.scale||1,defaultVal:e.value||0}},_target:{writable:!0,value:null},_targetVal:{writable:!0,value:null}}),this._build(e),this._rect=this._placeholder.getBoundingClientRect(),this._params.val=this._params.defaultVal,this._pos.x=(this._params.val-this._params.offset)/this._params.scale*(this._rect.width-18),this._pos.x=Math.min(this._rect.width-18,Math.max(0,this._pos.x)),this._control.style.left=this._pos.x+"px",this},e.UISliderH.prototype=Object.create(null,{_build:{value:function(e){this._container.appendChild(this._placeholder),this._container.appendChild(this._label),this._placeholder.appendChild(this._control);var t=e.targetDiv;if(void 0===t||null===t)throw console.err("invalid UI panel div"),"error";t.appendChild(this._container),this._container.style.left=e.x+"px",this._container.style.top=e.y+"px",this._container.className="wx-sliderH-container",this._placeholder.className="wx-sliderH-placeholder wx-gui-light",this._control.className="wx-sliderH-control wx-gui-light",this._label.className="wx-sliderH-label",this._label.textContent=e.label;var n=this;this._placeholder.addEventListener("mousedown",function(e){n._controlClicked.call(n,e)},!1)}},_controlClicked:{value:function(t){t.preventDefault(),this._prev.x=t.clientX-this._rect.left;var n=this;e.UIManager.selected=n,e.UIManager.onDragged=function(e){n._controlDragged.call(n,e)},e.UIManager.onReleased=function(e){n._controlReleased.call(n,e)},window.addEventListener("mousemove",e.UIManager.onDragged,!1),window.addEventListener("mouseup",e.UIManager.onReleased,!1)}},_controlDragged:{value:function(e){e.preventDefault(),e=e.clientX-this._rect.left,this._pos.x+=e-this._prev.x,this._pos.x=Math.min(this._rect.width-18,this._pos.x),this._pos.x=Math.max(0,this._pos.x),this._control.style.left=this._pos.x+"px",this._prev.x=e,this._params.val=this._pos.x/(this._rect.width-18)*this._params.scale+this._params.offset,this._label.textContent=this._params.val.toFixed(2),this._target&&this._target.setValueAtTime(this._params.val,0),this._targetValue&&(this._targetValue.object[this._targetValue.property]=this._params.val)}},_controlReleased:{value:function(t){t.preventDefault(),window.removeEventListener("mousemove",e.UIManager.onDragged,!1),window.removeEventListener("mouseup",e.UIManager.onReleased,!1),e.UIManager.selected=null,e.UIManager.onClicked=null,e.UIManager.onDragged=null,e.UIManager.onReleased=null}},target:{set:function(e){this._target=e},get:function(){return this._target}},getValue:{value:function(){return this._params.val}},setTargetValue:{value:function(e,t){this._targetValue={object:e,property:t}}}}),e.UISliderV=function(e){return Object.defineProperties(this,{_container:{value:document.createElement("div")},_placeholder:{value:document.createElement("div")},_control:{value:document.createElement("div")},_label:{value:document.createElement("div")},_rect:{writable:!0,value:null},_pos:{writable:!0,value:{x:0,y:0}},_prev:{writable:!0,value:{x:0,y:0}},_params:{writable:!0,value:{val:e.value||0,offset:e.offset||0,scale:e.scale||1,defaultVal:e.value||0}},_target:{writable:!0,value:null},_targetValue:{writable:!0,value:null}}),this._build(e),this._rect=this._placeholder.getBoundingClientRect(),this._params.val=this._params.defaultVal,this._pos.y=(this._params.val-this._params.offset)/this._params.scale*(this._rect.height-18),this._pos.y=Math.min(this._rect.height-18,Math.max(0,this._pos.x)),this._control.style.top=this._pos.y+"px",this},e.UISliderV.prototype=Object.create(null,{_build:{value:function(e){this._container.appendChild(this._placeholder),this._container.appendChild(this._label),this._placeholder.appendChild(this._control);var t=e.targetDiv;if(void 0===t||null===t)throw console.err("invalid UI panel div"),"error";t.appendChild(this._container),this._container.style.left=e.x+"px",this._container.style.top=e.y+"px",this._container.className="wx-sliderV-container",this._placeholder.className="wx-sliderV-placeholder wx-gui-light",this._control.className="wx-sliderV-control wx-gui-light",this._label.className="wx-sliderV-label",this._label.textContent=e.label;var n=this;this._placeholder.addEventListener("mousedown",function(e){n._controlClicked.call(n,e)},!1)}},_controlClicked:{value:function(t){t.preventDefault(),this._prev.y=t.clientY-this._rect.top;var n=this;e.UIManager.selected=n,e.UIManager.onDragged=function(e){n._controlDragged.call(n,e)},e.UIManager.onReleased=function(e){n._controlReleased.call(n,e)},window.addEventListener("mousemove",e.UIManager.onDragged,!1),window.addEventListener("mouseup",e.UIManager.onReleased,!1)}},_controlDragged:{value:function(e){e.preventDefault(),e=e.clientY-this._rect.top,this._pos.y+=e-this._prev.y,this._pos.y=Math.min(this._rect.height-18,this._pos.y),this._pos.y=Math.max(0,this._pos.y),this._control.style.top=this._pos.y+"px",this._prev.y=e,this._params.val=this._pos.y/(this._rect.height-18)*this._params.scale+this._params.offset,this._target&&this._target.setValueAtTime(this._params.val,0),this._targetValue&&(this._targetValue.object[this._targetValue.property]=this._params.val)}},_controlReleased:{value:function(t){t.preventDefault(),window.removeEventListener("mousemove",e.UIManager.onDragged,!1),window.removeEventListener("mouseup",e.UIManager.onReleased,!1),e.UIManager.selected=null,e.UIManager.onClicked=null,e.UIManager.onDragged=null,e.UIManager.onReleased=null}},getValue:function(){return this._params.val},target:{set:function(e){this._target=e},get:function(){return this._target}},setTargetValue:{value:function(e,t){this._targetValue={object:e,property:t}}}}),e.UIKnob=function(e){return Object.defineProperties(this,{_container:{value:document.createElement("div")},_placeholder:{value:document.createElement("div")},_control:{value:document.createElement("div")},_label:{value:document.createElement("div")},_rect:{writable:!0,value:null},_angle:{writable:!0,value:0},_prevAngle:{writable:!0,value:0},_params:{writable:!0,value:{val:e.value||0,offset:e.offset||0,scale:e.scale||1,defaultVal:e.value||0}},_target:{writable:!0,value:null},_targetValue:{writable:!0,value:null}}),this._build(e),this._rect=this._placeholder.getBoundingClientRect(),this._params.val=this._params.defaultVal,this._angle=270*((this._params.val-this._params.offset)/this._params.scale)+45,this._angle=Math.min(315,Math.max(45,this._angle)),this._control.style.webkitTransform="rotate("+this._angle+"deg)",this},e.UIKnob.prototype=Object.create(null,{_build:{value:function(e){this._container.appendChild(this._placeholder),this._container.appendChild(this._label),this._placeholder.appendChild(this._control);var t=e.targetDiv;if(void 0===t||null===t)throw console.err("invalid UI panel div"),"error";t.appendChild(this._container),this._container.style.left=e.x+"px",this._container.style.top=e.y+"px",this._container.className="wx-knob-container",this._placeholder.className="wx-knob-placeholder wx-gui-light",this._control.className="wx-knob-control wx-gui-light",this._label.className="wx-knob-label",this._label.textContent=e.label;var n=this;this._placeholder.addEventListener("mousedown",function(e){n._handleClicked.call(n,e)},!1)}},_getCurrentAngle:{value:function(e,t){var n=180*Math.atan2(this._rect.top+this._rect.height/2-t,this._rect.left+this._rect.width/2-e)/Math.PI+90;return 0<n?n:n+360}},_handleClicked:{value:function(t){t.preventDefault(),this._prevAngle=this._getCurrentAngle(t.clientX,t.clientY);var n=this;e.UIManager.selected=n,e.UIManager.onDragged=function(e){n._handleDragged.call(n,e)},e.UIManager.onReleased=function(e){n._handleReleased.call(n,e)},window.addEventListener("mousemove",e.UIManager.onDragged,!1),window.addEventListener("mouseup",e.UIManager.onReleased,!1)}},_handleDragged:{value:function(e){e.preventDefault(),e=this._getCurrentAngle(e.clientX,e.clientY);var t=e-this._prevAngle;180<t||-180>t||(this._angle+=t,this._angle=Math.min(315,Math.max(45,this._angle)),this._control.style.webkitTransform="rotate("+this._angle+"deg)",this._params.val=(this._angle-45)/270*this._params.scale+this._params.offset,this._label.textContent=this._params.val.toFixed(2),this._prevAngle=e,this._target&&this._target.setValueAtTime(this._params.val,0),this._targetValue&&(this._targetValue.object[this._targetValue.property]=this._params.val))}},_handleReleased:{value:function(t){t.preventDefault(),window.removeEventListener("mousemove",e.UIManager.onDragged,!1),window.removeEventListener("mouseup",e.UIManager.onReleased,!1),e.UIManager.selected=null,e.UIManager.onClicked=null,e.UIManager.onDragged=null,e.UIManager.onReleased=null}},target:{set:function(e){this._target=e},get:function(){return this._target}},getValue:{value:function(){return this._params.val}},setTargetValue:{value:function(e,t){this._targetValue={object:e,property:t}}}}),e}),define("SoundPlayer",["happy/_libs/datgui","WAAX"],function(e,t){var n=function(n){var r=this,i,s=["clap","wow","booh"],o=[],u,a,f,l,c,h,p,d,v,m,f,g,y,b,w,E,S,x;boohVolume=1,wowVolume=1;var T=function(){f=[],a=0;var n=new t.ConVerb({source:"audio/ir/960-BigEmptyChurch.wav",mix:.1}),r=new t.ConVerb({source:"audio/ir/960-BigEmptyChurch.wav",mix:.1}),i=new t.ConVerb({source:"audio/ir/960-BigEmptyChurch.wav",mix:.1});for(var s=0;s<10;s++){var o={};o.sampler=new t.Sampler({source:"audio/clap"+s%4+".wav"}),o.verb=new t.ConVerb({source:"audio/ir/960-BigEmptyChurch.wav",mix:.1}),t.link(o.sampler,o.verb,t.DAC),f.push(o)}p=[],h=0;for(var s=0;s<=11;s++){var o={};o.sampler=new t.Sampler({source:"audio/wow"+s+".wav"}),o.verb=new t.ConVerb({source:"audio/ir/960-BigEmptyChurch.wav",mix:.1}),t.link(o.sampler,o.verb,t.DAC),p.push(o)}boohs=[],m=0;for(var s=0;s<=5;s++){var o={};o.sampler=new t.Sampler({source:"audio/booh"+s+".wav"}),o.verb=new t.ConVerb({source:"audio/ir/960-BigEmptyChurch.wav",mix:.1}),t.link(o.sampler,o.verb,t.DAC),boohs.push(o)}g=[];for(var s=1;s<=5;s++)(function(){var e={};e.sampler=new t.Sampler({source:"audio/crowd"+s+".wav"}),t.link(e.sampler,t.DAC),g[s]=e,setTimeout(function(){e.sampler.noteOn(60),e.sampler._player.loop=!0,e.sampler._outputGain.gain.value=0,e.sampler._outputGain.gain.linearRampToValueAtTime(0,t.now+1)},2e3)})();c=0,l=0,v=0,d=0,b=0,E=0,y=0,setInterval(N,1e3),x={"Master Gain":1,"Wow Gain":1,"Booh Gain":1},S=new e,S.remember(x),S.add(x,"Master Gain",0,1).step(1e-17).onChange(function(e){t.DAC.gain=e}),t.DAC.gain=x["Master Gain"],S.add(x,"Wow Gain",0,1).step(1e-17),S.add(x,"Booh Gain",0,1).step(1e-17)},N=function(){w=b,b=0,E=Math.round(w/3.21),d=v,v=0,l=c,c=0,console.log("cps",w,"bps",d,"wps",l,"estimatedPeople",E);var e;E<15?e=0:E>=15&&E<20?e=1:E>=20&&E<30?e=2:E>=30&&E<40?e=3:E>=40&&E<50?e=4:E>=50&&(e=5),e!=y&&(y=e,O(y))},C=function(e){u=n.connect(e),u.on("error",function(){setTimeout(function(){u.socket.connect()},1e3)}),u.on("connect",M),u.on("login",_),u.on("clap",k),u.on("wow",L),u.on("booh",A)},k=function(){b++;if(y>0)return;f[a].verb.mix=.1;var e=Math.random()*2;f[a].sampler.gain=e,f[a].sampler.noteOn(Math.random()*2+59),a++,a==f.length&&(a=0)},L=function(){c++,console.log("Wow");if(l>10&&c%2!=0)return;if(l>20&&c%2!=0)return;var e=Math.round(Math.random()*9);p[e].verb.mix=.05+Math.random()*.1;var t=1-Math.random()*.4;p[e].sampler.gain=t*t*x["Wow Gain"],p[e].sampler.noteOn(Math.random()*6+57)},A=function(){v++,console.log("Booh");if(d>10&&v%2!=0)return;if(d>20&&v%2!=0)return;boohs[m].verb.mix=.05+Math.random()*.1;var e=1-Math.random()*.4;boohs[m].sampler.gain=e*e*x["Booh Gain"],boohs[m].sampler.noteOn(Math.random()*6+57),m++,m==boohs.length&&(m=0)},O=function(e){for(var n=1;n<6;n++){if(n==e)continue;g[n].sampler._outputGain.gain.linearRampToValueAtTime(0,t.now+1)}if(!e)return;console.log(g[e],e),g[e].sampler._outputGain.gain.linearRampToValueAtTime(1,t.now+1)},M=function(){u.emit("identity",{uuid:localStorage.getItem("player_uuid"),listens:s,reports:o})},_=function(e){i=e,localStorage.setItem("player_uuid",i),console.log("Login",i)};Object.defineProperty(r,"connect",{value:C}),Object.defineProperty(r,"clap",{value:k}),Object.defineProperty(r,"wow",{value:L}),Object.defineProperty(r,"booh",{value:A}),T()};return n}),define("App",["happy/app/BaseApp",_HOST+"/socket.io/socket.io.js","SoundPlayer"],function(e,t,n){var r=function(){var e=this;e.setup=function(){socketInterface=new n(t),socketInterface.connect(_HOST)}};return r.prototype=new e,r}),define("happy/utils/DOM",[],function(){var e=function(){var e=this,t=function(e,t){return typeof e.classList=="undefined"?e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")):e.classList.contains(t)},n=function(e,t){typeof e.classList=="undefined"?this.hasClass(e,t)||(e.className+=" "+t):e.classList.add(t)},r=function(e,n){if(typeof e.classList=="undefined"){if(t(e,n)){var r=new RegExp("(\\s|^)"+n+"(\\s|$)");e.className=e.className.replace(r," ")}}else e.classList.remove(n)},i=function(e){while(e.lastChild)e.removeChild(e.lastChild)},s=function(e){var t=e.offsetWidth,n=e.offsetHeight;return{width:t,height:n}};Object.defineProperty(e,"hasClass",{value:t}),Object.defineProperty(e,"addClass",{value:n}),Object.defineProperty(e,"removeClass",{value:r}),Object.defineProperty(e,"empty",{value:i}),Object.defineProperty(e,"measure",{value:s})};return e}),define("happy/polyfill/console",[],function(){return window.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}}}),define("happy/_libs/mout/array/forEach",[],function(){function e(e,t,n){if(e==null)return;var r=-1,i=e.length;while(++r<i)if(t.call(n,e[r],r,e)===!1)break}return e}),define("happy/_libs/mout/array/indexOf",[],function(){function e(e,t,n){n=n||0;var r=e.length,i=n<0?r+n:n;while(i<r){if(e[i]===t)return i;i+=1}return-1}return e}),define("happy/_libs/mout/array/combine",["./indexOf"],function(e){function t(t,n){var r,i=n.length;for(r=0;r<i;r++)e(t,n[r])===-1&&t.push(n[r]);return t}return t}),define("happy/_libs/mout/lang/toString",[],function(){function e(e){return e==null?"":e.toString()}return e}),define("happy/_libs/mout/string/replaceAccents",["../lang/toString"],function(e){function t(t){return t=e(t),t.search(/[\xC0-\xFF]/g)>-1&&(t=t.replace(/[\xC0-\xC5]/g,"A").replace(/[\xC6]/g,"AE").replace(/[\xC7]/g,"C").replace(/[\xC8-\xCB]/g,"E").replace(/[\xCC-\xCF]/g,"I").replace(/[\xD0]/g,"D").replace(/[\xD1]/g,"N").replace(/[\xD2-\xD6\xD8]/g,"O").replace(/[\xD9-\xDC]/g,"U").replace(/[\xDD]/g,"Y").replace(/[\xDE]/g,"P").replace(/[\xE0-\xE5]/g,"a").replace(/[\xE6]/g,"ae").replace(/[\xE7]/g,"c").replace(/[\xE8-\xEB]/g,"e").replace(/[\xEC-\xEF]/g,"i").replace(/[\xF1]/g,"n").replace(/[\xF2-\xF6\xF8]/g,"o").replace(/[\xF9-\xFC]/g,"u").replace(/[\xFE]/g,"p").replace(/[\xFD\xFF]/g,"y")),t}return t}),define("happy/_libs/mout/string/removeNonWord",["../lang/toString"],function(e){function t(t){return t=e(t),t.replace(/[^0-9a-zA-Z\xC0-\xFF \-]/g,"")}return t}),define("happy/_libs/mout/string/upperCase",["../lang/toString"],function(e){function t(t){return t=e(t),t.toUpperCase()}return t}),define("happy/_libs/mout/string/lowerCase",["../lang/toString"],function(e){function t(t){return t=e(t),t.toLowerCase()}return t}),define("happy/_libs/mout/string/camelCase",["../lang/toString","./replaceAccents","./removeNonWord","./upperCase","./lowerCase"],function(e,t,n,r,i){function s(s){return s=e(s),s=t(s),s=n(s).replace(/\-/g," ").replace(/\s[a-z]/g,r).replace(/\s+/g,"").replace(/^[A-Z]/g,i),s}return s}),define("happy/_libs/mout/string/pascalCase",["../lang/toString","./camelCase","./upperCase"],function(e,t,n){function r(r){return r=e(r),t(r).replace(/^[a-z]/,n)}return r}),define("happy/utils/Vendor",["../polyfill/console","../_libs/mout/array/forEach","../_libs/mout/array/combine","../_libs/mout/string/pascalCase"],function(e,t,n,r){var i=["WebKit","Moz","O","Ms"],s=[],o=[];t(i,function(e){s.push(r(e)),o.push(e.toLowerCase())});var u=n(s,o),a=function(){var t=this,n=function(t,n){if(!t)return;var i=r(t);n=n||window;var s=t,o=n[s];if(typeof o=="undefined")for(var a=0;a<u.length;a++){s=u[a]+i,o=n[s];if(typeof o!="undefined")break}if(typeof o=="undefined"){e.log(t+" is not implemented.");return}return{name:s,context:n}},i=function(e,t){var r=n(e,t);if(!r)return;return function(){r.context[r.name].apply(r.context,arguments)}},s=function(e,t){var r=n(e,t);if(!r)return;return r.context[r.name]},o=function(e,t){var r=n(e,t);if(!r)return;return r.name};Object.defineProperty(t,"validateMethod",{value:i}),Object.defineProperty(t,"validateConstructor",{value:s}),Object.defineProperty(t,"validateName",{value:o})};return a}),define("happy/_libs/mout/object/hasOwn",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return e}),define("happy/_libs/mout/lang/kindOf",[],function(){function r(r){return r===null?"Null":r===n?"Undefined":e.exec(t.call(r))[1]}var e=/^\[object (.*)\]$/,t=Object.prototype.toString,n;return r}),define("happy/_libs/mout/lang/isPlainObject",[],function(){function e(e){return!!e&&typeof e=="object"&&e.constructor===Object}return e}),define("happy/_libs/mout/object/forIn",[],function(){function n(){t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=!0;for(var n in{toString:null})e=!1}function r(r,s,o){var u,a=0;e==null&&n();for(u in r)if(i(s,r,u,o)===!1)break;if(e)while(u=t[a++])if(r[u]!==Object.prototype[u]&&i(s,r,u,o)===!1)break}function i(e,t,n,r){return e.call(r,t[n],n,t)}var e,t;return r}),define("happy/_libs/mout/object/forOwn",["./hasOwn","./forIn"],function(e,t){function n(n,r,i){t(n,function(t,s){if(e(n,s))return r.call(i,n[s],s,n)})}return n}),define("happy/_libs/mout/object/mixIn",["./forOwn"],function(e){function t(t,r){var i=0,s=arguments.length,o;while(++i<s)o=arguments[i],o!=null&&e(o,n,t);return t}function n(e,t){this[t]=e}return t}),define("happy/_libs/mout/lang/clone",["./kindOf","./isPlainObject","../object/mixIn"],function(e,t,n){function r(t){switch(e(t)){case"Object":return i(t);case"Array":return u(t);case"RegExp":return s(t);case"Date":return o(t);default:return t}}function i(e){return t(e)?n({},e):e}function s(e){var t="";return t+=e.multiline?"m":"",t+=e.global?"g":"",t+=e.ignorecase?"i":"",new RegExp(e.source,t)}function o(e){return new Date(+e)}function u(e){return e.slice()}return r}),define("happy/_libs/mout/lang/deepClone",["./clone","../object/forOwn","./kindOf","./isPlainObject"],function(e,t,n,r){function i(t,r){switch(n(t)){case"Object":return s(t,r);case"Array":return o(t,r);default:return e(t)}}function s(e,n){if(r(e)){var s={};return t(e,function(e,t){this[t]=i(e,n)},s),s}return n?n(e):e}function o(e,t){var n=[],r=-1,s=e.length,o;while(++r<s)n[r]=i(e[r],t);return n}return i}),define("happy/_libs/mout/lang/isKind",["./kindOf"],function(e){function t(t,n){return e(t)===n}return t}),define("happy/_libs/mout/lang/isObject",["./isKind"],function(e){function t(t){return e(t,"Object")}return t}),define("happy/_libs/mout/object/merge",["./hasOwn","../lang/deepClone","../lang/isObject"],function(e,t,n){function r(){var i=1,s,o,u,a;a=t(arguments[0]);while(u=arguments[i++])for(s in u){if(!e(u,s))continue;o=u[s],n(o)&&n(a[s])?a[s]=r(a[s],o):a[s]=t(o)}return a}return r}),define("happy/app/Runner",["../utils/DOM","../utils/Vendor","../_libs/mout/object/merge"],function(e,t,n){var r=new t,i=new e,s=r.validateMethod("requestAnimationFrame"),o=r.validateConstructor("MutationObserver"),u=function(e){function y(){l(y);var t=g(),n=t-a;a=t,f=a-u,e.update.apply(e,[n,f]),e.draw.apply(e,[n,f])}var t=this,n=e.container,u,a,f,l;n.tabIndex="1",n.addEventListener("keyup",function(t){e.onKeyUp.apply(e,[t])},!1),n.addEventListener("keydown",function(t){e.onKeyDown.apply(e,[t])},!1),n.addEventListener("mouseover",function(t){e.onMouseOver.apply(e,[t])},!1),n.addEventListener("mouseout",function(t){e.onMouseOut.apply(e,[t])},!1),n.addEventListener("mousedown",function(t){e.onMouseDown.apply(e,[t])},!1),n.addEventListener("mouseup",function(t){e.onMouseUp.apply(e,[t])},!1),n.addEventListener("mousemove",function(t){e.onMouseMove.apply(e,[t])},!1),n.addEventListener("click",function(t){e.onClick.apply(e,[t])},!1),n.addEventListener("dblclick",function(t){e.onDoubleClick.apply(e,[t])},!1);var c=i.measure(n),h=function(){var t=i.measure(n);(t.width!=c.width||t.height!=c.height)&&e.onResize.apply(e,[t]),c=t};window.addEventListener("resize",h,!1),window.addEventListener("scroll",h,!1);if(o){var p=new o(h);p.observe(document.body,{subtree:!0,childList:!0,characterData:!0,attribute:!0})}var d=function(){r.validateMethod("cancelFullScreen",document).apply(document)},v=function(){r.validateMethod("requestFullScreen",n).apply(n,[Element.ALLOW_KEYBOARD_INPUT])},m=!1;e.enterFullscreen=function(){m=!0,v(),n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.minWidth="100%",n.style.minHeight="100%",n.style.maxWidth="100%",n.style.maxHeight="100%"},e.exitFullscreen=function(){m=!1,n.removeAttribute("style"),d()},e.toggleFullscreen=function(){m?e.exitFullscreen():e.enterFullscreen()},e.isFullscreen=function(){return m},e.setFPS=function(e){e<0&&(e=0);switch(e){case"auto":s?l=s:l=function(e){setTimeout(e,1e3/60)};break;case 0:l=function(e){};break;default:l=function(t){setTimeout(t,1e3/e)}}};var g;window.performance&&window.performance.now?g=function(){return window.performance.now()*.001}:window.performance&&window.performance.webkitNow?g=function(){return window.performance.webkitNow()*.001}:g=function(){return(new Date).getTime()*.001},e.setFPS("auto"),e.setup.apply(e),e.onResize.apply(e,[c]),u=g(),a=u,f=0,y()};return u}),require(["App","happy/app/Runner"],function(e,t){var n=new e,r=new t(n)}),define("main",function(){});